services:

  ewm-api:
    build:
      context: ./ewm-api
      dockerfile: Dockerfile
    image: java-explore/ewm-api:latest
    container_name: ewm-api
    ports:
      - "8080:8080"
    environment:
      SHAREIT_URL: ${SHAREIT_URL:-http://host.docker.internal:8080}
      SERVER_PORT: ${EWMPORT:-8080}
    depends_on:
      - stats-db      # если нужен порядок старта

  stats-db:
    image: postgres:16.1
    container_name: stats-db
    environment:
      POSTGRES_DB: stats
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: secret
    volumes:
      - stats-db-data:/var/lib/postgresql/data

  ewm-stats:
    build:
      context: ./ewm-statistic-service
      dockerfile: Dockerfile
    image: java-explore/ewm-stats:latest
    container_name: ewm-stats
    ports:
      - "9090:9090"
    environment:
      SERVER_PORT: ${STATS_PORT:-9090}
    depends_on:
      - stats-db
      - ewm-api   # если нужно ждать API

volumes:
  stats-db-data:
